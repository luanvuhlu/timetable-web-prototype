<!DOCTYPE html>
<html lang="en" class="no-js">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <title>Flexible Calendar</title>
        <meta name="description" content="Blueprint: Vertical Timeline" />
        <meta name="keywords" content="timeline, vertical, layout, style, component, web development, template, responsive" />
        <meta name="author" content="Codrops" />
        <link rel="shortcut icon" href="../favicon.ico">
        <link rel="stylesheet" type="text/css" href="css/timeline.css" />
        <link rel="stylesheet" type="text/css" href="css/calendar-day.css" />
        <link rel="stylesheet" type="text/css" href="css/custom_4.css" />
        <script src="js/modernizr.custom.63321.js"></script>
    </head>
    <body>
        <div class="container">
            <!-- Codrops top bar -->
            <div class="codrops-top clearfix" style="text-align: center;">
                <a href="http://tympanus.net/Development/Stapel/" style="float: left"><strong>&laquo; Previous Demo: </strong>Adaptive Thumbnail Pile Effect</a>
                <a id="view" href="#">View Calendar</a>
                <span class="right">
                    <a href="http://tympanus.net/codrops/?p=12416"><strong>Back to the Codrops Article</strong></a>
                </span>
            </div><!--/ Codrops top bar -->
            <div class="main">
                <div class="custom-calendar-wrap">
                    <div id="custom-inner" class="custom-inner">
                        <div class="custom-header clearfix">
                            <nav>
                                <span id="custom-prev" class="custom-prev"></span>
                                <span id="custom-next" class="custom-next"></span>
                            </nav>
                            <h2 id="custom-month" class="custom-month"></h2>
                            <h3 id="custom-year" class="custom-year"></h3>
                        </div>
                        <div id="calendar" class="fc-calendar-container"></div>
                    </div>
                </div>
                <header class="clearfix">
                    <h1>Calendario <span>It just got more flexible</span></h1>
                   
                </header>
                <ul class="cbp_tmtimeline">
                    <li class="all-day">
                        <time class="cbp_tmtime" datetime="all-day"><span>all-day</span></time>
                    </li>
                   <!--  <li>
                        <time class="cbp_tmtime" datetime="00:00"><span>00:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="01:00"><span>01:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="02:00"><span>02:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="03:00"><span>03:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="04:00"><span>04:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="05:00"><span>05:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="06:00"><span>06:00</span></time>
                    </li> -->
                    <li>
                        <time class="cbp_tmtime" datetime="07:00"><span>07:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="08:30"><span>08:30</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="08:40"><span>08:40</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="10:10"><span>10:10</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="10:20"><span>10:20</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="11:50"><span>11:50</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="13:00"><span>13:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="14:30"><span>14:30</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="14:40"><span>14:40</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="16:10"><span>16:10</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="16:20"><span>16:20</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="17:50"><span>17:50</span></time>
                    </li>
                    <!-- <li>
                        <time class="cbp_tmtime" datetime="19:00"><span>19:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="20:00"><span>20:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="21:00"><span>21:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="22:00"><span>22:00</span></time>
                    </li>
                    <li>
                        <time class="cbp_tmtime" datetime="23:00"><span>23:00</span></time>
                    </li> -->
                </ul>
            </div>
        </div>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery.calendario.js"></script>
        <script>
        var maxHeight=150;
        var timelineEvents = {
                'TODAY': [
                    // {content: '<span>John Applesed\'s Birthday</span>', allDay: true},
                    // {content: '<span>Arnold Mathew\'s Birthday</span>', allDay: true},
                    // {content: '<span>Captain X\'s Birthday</span>', allDay: true},
                    // {content: '<span>Sleep, sleep, sleep!</span>', startTime: '00:00', endTime: '06:00'}, 
                    // {content: '<span>Wake Up! Get Ready! 30 Mins Max :)</span>', startTime: '06:00', endTime: '06:30'},
                    // {content: '<span>I\'m getting late for work! GOD!! (Average time 17mins to reach)</span>', startTime: '06:30', endTime: '06:47'},
                    // {content: '<a href="https://en.wikipedia.org/wiki/LIFI">Make report on Li-Fi</a>', startTime: '06:47', endTime: '12:00'},
                    // {content: '<span>Lunch with friend\'s at KFC</span>', startTime: '12:00', endTime: '13:00'}, 
                    // {content: '<span>10mins break :p</span>', startTime: '13:00', endTime: '13:10'},
                    // {content: '<span>Have no clue? O.o</span>', startTime: '13:20', endTime: '17:41'},
                    // {content: '<span>Quick nap, after returning home!</span>', startTime: '18:00', endTime: '18:20'},
                    // {content: '<span>Dinner with my Girl Friend</span>', startTime: '19:00', endTime: '21:30'},
                    // {content: '<span>Prepare for Sleep!</span>', startTime: '22:00', endTime: '23:01'},
                    // {content: '<span>Trying to sleep</span>', startTime: '23:01', endTime: '00:00'}
                ]
            };

            (function($){
                $(window).load(function(){
                    var once = false,
                        today = new Date(Date.now()),
                        zoneH = parseInt(today.getTimezoneOffset() / 60),
                        zoneM = parseInt(today.getTimezoneOffset() % 60),
                        zoneS = (zoneH < 0 ? '+' : '-') + (Math.abs(zoneH) < 10 ? '0' + Math.abs(zoneH) : Math.abs(zoneH)) + ':' +
                        (Math.abs(zoneM) < 10 ? '0' + Math.abs(zoneM) : Math.abs(zoneM));
                    $(document).on('shown.calendar.calendario', function(e, instance){
                        if(!once) {
                            $('.custom-calendar-wrap').slideUp();
                            init();
                            instance.getCell(today.getDate()).trigger('custom.calendario');
                            once = true;
                        }
                    });
                    
                    $('#view').on('click calClick', function(e){
                        e.preventDefault();
                        $('.custom-calendar-wrap').slideToggle();
                    });
                    
                    var transEndEventNames = {
                        'WebkitTransition' : 'webkitTransitionEnd',
                        'MozTransition' : 'transitionend',
                        'OTransition' : 'oTransitionEnd',
                        'msTransition' : 'MSTransitionEnd',
                        'transition' : 'transitionend'
                    },
                    transEndEventName = transEndEventNames[Modernizr.prefixed('transition')],
                    $wrapper = $('#custom-inner'),
                    $calendar = $('#calendar'),
                    cal = $calendar.calendario({
                        onDayClick : function( $el, data, dateProperties ) {
                            if( data.content.length > 0 ) {
                                if(data.startTime.length > 0) {
                                    $('#view').trigger('calClick');
                                    reset();
                                    for(var i = 0; i < data.startTime.length; i++) {
                                        if(data.allDay[i]) {
                                            allDay(data.content[i]);
                                        }else {
                                            date(data.content[i], data.startTime[i], data.endTime[i]);
                                        }
                                    }
                                }
                            }
                        },
                        onDayCustom : function( $el, data, dateProperties ) {
                            if( data.content.length > 0 ) {
                                if(data.startTime.length > 0) {
                                    reset();
                                    for(var i = 0; i < data.startTime.length; i++) {
                                        if(data.allDay[i]) {
                                            allDay(data.content[i]);
                                        } else {
                                            date(data.content[i], data.startTime[i], data.endTime[i]);    
                                        }
                                        
                                    }
                                }
                            }
                        },
                        caldata : timelineEvents,
                        displayWeekAbbr : true,
                        events: 'click, custom',
                        zone: zoneS
                    }),
                    $month = $( '#custom-month' ).html( cal.getMonthName() ),
                    $year = $( '#custom-year' ).html( cal.getYear() );
                    
                    $( '#custom-next' ).on( 'click', function() {
                        cal.gotoNextMonth( updateMonthYear );
                    });
                    $( '#custom-prev' ).on( 'click', function() {
                        cal.gotoPreviousMonth( updateMonthYear );
                    });
                    
                    function init() {
                        var d = new Date(), hour;
                        $('ul > li:not(.all-day)').each(function(i, e){
                            d = calTime(e);
                            fixHeight(e)
                            hour = d.getHours();
                            minituesInt = d.getMinutes();
                            minitues=minituesInt < 10 ?('0'+minituesInt): minituesInt
                            // $(e).find('time').attr('datetime', d.toISOString());
                            if(hour < 10) $(e).find('time > span').html('0' + hour + ':' + minitues+'<h6>AM</h6>');
                            else if(hour < 12 && hour >= 10) $(e).find('time > span').html(hour + ':' + minitues+'<h6>AM</h6>');
                            else if(hour == 12) $(e).find('time > span').html(hour + ':' + minitues+'<h6>PM</h6>');
                            else if(hour < 22 && hour > 12) $(e).find('time > span').html('0' + (hour - 12) + ':' + minitues+'<h6>PM</h6>');
                            else if(hour >= 22) $(e).find('time > span').html((hour - 12) + ':' + minitues+'<h6>PM</h6>');
                        });
                    }
                    function fixHeight(e){
                        if($(e).is(':nth-child(2), :last-child'))
                        {
                            $(e).css('height', maxHeight+'px');
                            return;
                        }
                        var e1=$(e).prev(), end=calTime(e), start=calTime(e1)
                        console.log(getMinutesHours(end) +' - '+getMinutesHours(start));
                        $(e1).css('height', maxHeight*(getMinutesHours(end)-getMinutesHours(start))/60+'px');
                        // console.log(time1-time)
                    }
                    function getMinutesHours(d){
                        return d.getHours()*60+d.getMinutes();
                    }
                    function calTime(e){
                        var d = new Date();
                        var time = $(e).find('time').attr('datetime');
                        var hour = parseInt(time.split(':')[0]);
                        var minituesInt = parseInt(time.split(':')[1]);
                        d.setHours(hour, minituesInt, 0, 0);
                        return d;
                    }
                    function updateMonthYear() {                
                        $month.html( cal.getMonthName() );
                        $year.html( cal.getYear() );
                    }

                    function allDay(content) {              
                        $('li.all-day').append('<div class="cbp_tmlabel">' + content + '</div>');
                    }
                    function removeAllDayTag(){
                        $('li.all-day').remove();
                    }
                    function date(content, start, end) {
                    // Start 7:00                
                        var pos = start.getHours() -5,
                            top = ((start.getMinutes() / 60) * maxHeight) == 0 ? '-1px' :  ((start.getMinutes() / 60) * maxHeight) - 1 + 'px',
                            height = ((((end.getTime() - start.getTime()) / (60 * 1000 * 60)) * maxHeight) - 1) + 'px',
                            append = '<div class="cbp_tmlabel" style="top:'+ top + ';height:' + height + '; max-height:' + height + '">' +
                                content + '</div>';
                        $('ul > li:nth-child(' + pos +')').append(append);
                    }
                    
                    function reset() {              
                        $('li').find('div.cbp_tmlabel').remove();
                    }
                });
            })(jQuery);
    </script>
    </body>
</html>
